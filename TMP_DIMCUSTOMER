"
INSERT INTO DEV_SNPL_IL_DB.INT.TMP_DIMCUSTOMER
SELECT DISTINCT

-- INITIAL QUERY -
 ADDRESSNUMBER CUSTOMERID
,NAMEALPHA CUSTOMER
,COSTCENTER COSTCENTERID
,ALTERNATEADDRESSKEY MNEMONICID
,CASE WHEN REPORTCODEADDBOOK017 <> 'E' THEN 1 ELSE 0 END HIERARCHYFILTER
,CASE WHEN ADDRESSNUMBER NOT IN ('10240', '10430', '10440', '10730', '10740', '18830', '18835', '18837', '333333', '530813', '999999') THEN 1 ELSE 0 END SHIPTOFILTER
,CASE WHEN IFNULL(COSTCENTER,'') NOT IN  ('10440', '18940', '10240', '18830', '188910001') THEN 1 ELSE 0 END BUSINESSUNITFILTER
,CASE WHEN IFNULL(REPORTCODEADDBOOK015,'') <> '' AND REPORTCODEADDBOOK015 NOT LIKE 'F%' AND SUBSTRING(REPORTCODEADDBOOK015,2,2) <> '99' THEN 1 ELSE 0 END SALESMANAGERFILTER

-- MAPPING --
,ABM1.ADDRESSTYPE1 SEARCHTYPEID
,U1.DESCRIPTION001 SEARCHTYPE
,ABM1.REPORTCODEADDBOOK004 TERRITORYID
,u2.DESCRIPTION001 PBCSCUSTOMERID
,ABM1.REPORTCODEADDBOOK017 HIERARCHYCHECKID
,u3.DESCRIPTION001 HIERARCHYCHECK
,u4.description01002 MANUFACTURINGTYPE
,u4.specialhandlingcode CUSTOMERCLASS
,u2.description01002 SALESTYPE
,u2.specialhandlingcode CONTRACTCODE
,ABM1.REPORTCODEADDBOOK014 CUSTOMERTYPEID
,u5.description001 CUSTOMERTYPE
,CASE WHEN ABM1.REPORTCODEADDBOOK014 = ' ' THEN '-1' ELSE ABM1.REPORTCODEADDBOOK014 END CUSTOMERCODEID
,u2.description001 CUSTOMERCODE
,CASE WHEN ABM1.REPORTCODEADDBOOK015 = ' ' THEN '-1' ELSE ABM1.REPORTCODEADDBOOK015 END SALESMANAGERID
,u6.description001 SALESMANAGER
,u6.description01002 SALESMANAGERREGION
,CASE WHEN ABM1.REPORTCODEADDBOOK014 = ' ' THEN '-1' ELSE ABM1.REPORTCODEADDBOOK014 END CUSTOMERAGGRLEVELID
,CASE WHEN ABM1.REPORTCODEADDBOOK014 = ' ' THEN '-1' ELSE U2.DESCRIPTION001 END CUSTOMERAGGRLEVEL
,CASE WHEN ABM1.REPORTCODEADDBOOK014 = ' ' THEN '-1' ELSE ABM1.REPORTCODEADDBOOK014 END PLANNINGLEVELID
,CASE WHEN ABM1.REPORTCODEADDBOOK014 = ' ' THEN '-1' ELSE U2.DESCRIPTION001 END PLANNINGLEVEL
,CASE WHEN ABM1.REPORTCODEADDBOOK012 = ' ' THEN '-1' ELSE ABM1.REPORTCODEADDBOOK012 END CORPORATECODEID
,U4.DESCRIPTION001 CORPORATECODE

-- QUERY SNIPPET --
,CASE WHEN CONCAT(HierarchyFilter,ShipToFilter) = 11 THEN 1 ELSE 0 END ACTUALSFILTER
,CASE WHEN CONCAT(HierarchyFilter,ShipToFilter,BusinessUnitFilter,SalesManagerFilter) = 1111 THEN 1 ELSE 0 END PLANNINGFILTER

,ABM1.LAST_UPDATED_TS LAST_UPDATED_TS
,ABM1.SRC_DELETED_FLG SRC_DELETED_FLG
,current_timestamp CREATED_DATETIME
,current_user CREATED_BY
,current_timestamp UPDATED_DATETIME
,current_user UPDATED_BY

FROM 
DEV_SNPL_RL_DB.SRC_JDEE1.ADDRESSBOOKMASTER ABM1
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U1 on ABM1.ADDRESSTYPE1 = U1.USERDEFINEDCODE and U1.PRODUCTCODE = '01' and U1.USERDEFINEDCODES = 'ST'
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U2 on ABM1.REPORTCODEADDBOOK014 = U2.USERDEFINEDCODE and U2.PRODUCTCODE = '01' and U2.USERDEFINEDCODES = '13'
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U3 on ABM1.REPORTCODEADDBOOK017 = U3.USERDEFINEDCODE and U3.PRODUCTCODE = '01' and U3.USERDEFINEDCODES = '17'
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U4 on ABM1.REPORTCODEADDBOOK012 = U4.USERDEFINEDCODE and U4.PRODUCTCODE = '01' and U4.USERDEFINEDCODES = '12'
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U5 on ABM1.REPORTCODEADDBOOK014 = U5.USERDEFINEDCODE and U5.PRODUCTCODE = '01' and U5.USERDEFINEDCODES = '14'
LEFT JOIN  DEV_SNPL_RL_DB.SRC_JDEE1.USERDEFINEDCODEVALUES U6 on ABM1.REPORTCODEADDBOOK015 = U6.USERDEFINEDCODE and U6.PRODUCTCODE = '01' and U6.USERDEFINEDCODES = '15'



WHERE (ADDRESSTYPE1 LIKE 'C%' OR ADDRESSTYPE1 IN ('FC', 'IC') OR ADDRESSTYPE1 = 'PBE' OR ADDRESSNUMBER = 536680) AND ADDRESSTYPE1 NOT IN ('CAP') AND ABM1.LAST_UPDATED_TS > '" + $MAX_UPDATED_DATE + "' ;"
